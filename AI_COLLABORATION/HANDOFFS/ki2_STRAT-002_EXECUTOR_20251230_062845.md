---
status: COMPLETE
task: STRAT-002
role: EXECUTOR
phase: EXECUTOR
files_changed:
  - kenobase/analysis/number_arbitrage.py
  - scripts/backtest_number_arbitrage.py
  - tests/unit/test_number_arbitrage.py
  - results/number_arbitrage_backtest.json
summary:
  - Created kenobase/analysis/number_arbitrage.py with Train/Test split, frozen-rules evaluation, null model
  - Created scripts/backtest_number_arbitrage.py with full backtest workflow
  - Created tests/unit/test_number_arbitrage.py with 13 passing unit tests
  - Ran backtest on real data: KENO->AUSWAHLWETTE lag=7, split=2024-01-01
  - Result: 0 rules discovered in train (2022-2023), 0 significant in test
  - EuroJackpot negative control correctly shows 0 rules (Axiom-First compliant)
  - ROI sanity check with Axiom A1 warning implemented
  - Null model (schedule-preserving permutation) baseline established
---

# Rule Confirmation
- Rule 1 (SYSTEM_STATUS + ADR/Docs + git status): CONFIRMED
- Rule 2 (granularity stated): per-number-pair
- Rule 3 (semantics defined): ArbitrageRule dataclass with trigger/target_number/lag_days/lift/q_value
- Rule 4 (target metric): Test-Set Lift > 1.1 AND q_value < 0.05
- Rule 5 (helper-only boundaries): CONFIRMED
- Rule 6 (reproducibility): `python scripts/backtest_number_arbitrage.py` -> `results/number_arbitrage_backtest.json`

## Task Setup
- Granularity: per-number-pair (source_game.trigger_number -> target_game.target_number @ lag_days)
- Semantics: ArbitrageRule dataclass
- Target metric: Test-Set Lift > 1.1 AND p_value < 0.05

## Repro Commands
- `python scripts/backtest_number_arbitrage.py` -> `results/number_arbitrage_backtest.json`
- `python -m pytest tests/unit/test_number_arbitrage.py -v` -> 13 passed

# Umsetzung

## 1. Module Created: kenobase/analysis/number_arbitrage.py

Key functions:
- `split_game_draws_by_date()`: Split GameDraws into train/test by date
- `discover_arbitrage_rules()`: Find significant lift rules in train set
- `evaluate_rule_on_test()`: Frozen evaluation on test set (no parameter changes)
- `schedule_preserving_permutation()`: Null model (shuffles numbers, keeps dates)
- `run_null_model()`: Run multiple permutations for null distribution
- `backtest_number_arbitrage()`: Complete backtest workflow
- `roi_sanity_check()`: Axiom A1 compliance check (ROI > 0% warning)

## 2. Script Created: scripts/backtest_number_arbitrage.py

CLI arguments:
- `--keno`, `--auswahlwette`, `--eurojackpot`: Data paths
- `--split-date`: Train/test split (default: 2024-01-01)
- `--lag`: Lag days (default: 7, per ecosystem_graph)
- `--n-permutations`: Null model iterations (default: 100)
- `--output`: JSON output path

## 3. Unit Tests: tests/unit/test_number_arbitrage.py

13 tests covering:
- Split functionality
- Schedule-preserving permutation
- Rule discovery
- Frozen rule evaluation
- Null model
- ROI sanity check
- Full integration flow

## 4. Backtest Results

```
Train period: 2022-01-03 to 2023-12-31
Test period:  2024-01-01 to 2025-12-29

Rules discovered in train: 0
Rules significant in test: 0

Null model (50 permutations):
  Mean max lift: 0.929
  95th percentile: 3.046
  99th percentile: 3.323

Negative control (EuroJackpot):
  Rules discovered: 0
  Rules significant in test: 0
```

## Interpretation

The ecosystem_graph edge (KENO->AUSWAHLWETTE, lag=7, lift=2.41, q=0.027) was discovered using
the full dataset. When splitting into train (2022-2023) vs test (2024+), no rules survive
the FDR threshold in the train set alone.

This is consistent with Axiom-First expectations:
1. The lottery system is designed to prevent exploitable patterns
2. Marginal edges found in full data may not persist in out-of-sample
3. Negative control (EuroJackpot) correctly shows no correlation

## Files

- `kenobase/analysis/number_arbitrage.py` (NEW, 407 lines)
- `scripts/backtest_number_arbitrage.py` (NEW, 221 lines)
- `tests/unit/test_number_arbitrage.py` (NEW, 228 lines)
- `results/number_arbitrage_backtest.json` (NEW, output)
