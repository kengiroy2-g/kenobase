---
status: COMPLETE
task: HYP-012
role: EXECUTOR
phase: EXECUTOR
files_changed:
  - kenobase/analysis/stake_correlation.py
  - scripts/analyze_hyp012.py
  - tests/unit/test_stake_correlation.py
  - kenobase/analysis/__init__.py
summary:
  - Created stake_correlation.py module following HYP-010 pattern
  - Implemented StakeCorrelationResult, NumberStakeClassification, StakeAnalysisSummary dataclasses
  - Added load_stake_data() for CSV with semicolon delimiter and German number format
  - Implemented analyze_stake_correlation(), analyze_auszahlung_correlation(), analyze_restbetrag_correlation()
  - Created analyze_hyp012.py script with CLI interface
  - Created test_stake_correlation.py with 15 unit tests (all passing)
  - Updated analysis/__init__.py with new exports
  - Verified with real data: 365 draws loaded, analysis complete
---

# Rule Confirmation
- Rule 1 (SYSTEM_STATUS + ADR/Docs + git status): CONFIRMED
- Rule 2 (granularity stated): per-draw
- Rule 3 (semantics defined): Spieleinsatz, Total_Auszahlung, Restbetrag, z1-z20
- Rule 4 (target metric): Pearson/Spearman correlation coefficients
- Rule 5 (helper-only boundaries): CONFIRMED
- Rule 6 (reproducibility): `python scripts/analyze_hyp012.py` -> `results/hyp012_stake_correlation.json`

## Task Setup
- Granularity: per-draw
- Semantics: Spieleinsatz (stake), Total_Auszahlung (payout), Restbetrag (remainder), z1-z20 (drawn numbers)
- Target metric: Pearson/Spearman correlation between draw frequency and stake amounts

## Repro Commands
- `python scripts/analyze_hyp012.py` -> `results/hyp012_stake_correlation.json`
- `python -m pytest tests/unit/test_stake_correlation.py -v` -> 15/15 tests passed

# Umsetzung

## Files Created

### 1. kenobase/analysis/stake_correlation.py
- Module for HYP-012 stake-number correlation analysis
- Data classes: StakeCorrelationResult, NumberStakeClassification, StakeAnalysisSummary, StakeDrawRecord
- Functions: load_stake_data, analyze_stake_correlation, classify_numbers_by_stake, run_hyp012_analysis
- Additional: analyze_auszahlung_correlation, analyze_restbetrag_correlation

### 2. scripts/analyze_hyp012.py
- CLI script with argparse
- Default paths: Keno_GPTs/Keno_Ziehung2023_+_Restbetrag_v2.CSV
- Output: results/hyp012_stake_correlation.json
- Prints correlation results and interpretation

### 3. tests/unit/test_stake_correlation.py
- 15 unit tests covering all main functions
- Test classes: TestAggregateStakeByDate, TestCalculateNumberStakeScores, TestCalculateDrawFrequencyFromRecords, TestAnalyzeStakeCorrelation, TestClassifyNumbersByStake, TestStakeCorrelationResultDataclass, TestStakeDrawRecord

### 4. kenobase/analysis/__init__.py
- Added imports for stake_correlation module
- Added exports to __all__

## Verification Results

### Unit Tests
```
15 passed in 0.78s
```

### Real Data Analysis
```
Data: 365 draws analyzed

Spieleinsatz Correlation:
  Pearson:  r=0.0807, p=0.5068
  Spearman: r=0.0518, p=0.6703
  Significant: False

Total Auszahlung Correlation:
  Pearson:  r=0.3381, p=0.0042
  Significant: True

Restbetrag Correlation:
  Pearson:  r=-0.3202, p=0.0069
  Significant: True

Classification:
  Low-stake numbers (8): [6, 14, 22, 24, 36, 42, 60, 64]
  High-stake numbers (15): [4, 11, 12, 13, 20, 28, 41, 44, 49, 52, 56, 58, 59, 66, 68]
```

## Key Finding
- **Spieleinsatz**: No significant correlation (p=0.5068)
- **Total_Auszahlung**: Significant positive correlation (r=0.34, p=0.004)
- **Restbetrag**: Significant negative correlation (r=-0.32, p=0.007)

Numbers appear independent of stake amounts, but correlate with payout patterns.
