---
status: COMPLETE
task: POP-001
role: EXECUTOR
phase: EXECUTOR
files_changed:
  - kenobase/analysis/popularity_risk.py
  - kenobase/analysis/__init__.py
  - tests/unit/test_popularity_risk.py
  - scripts/backtest_popularity_risk.py
summary:
  - Neues Modul popularity_risk.py mit PopularityRiskScore, calculate_pattern_risk_score(), estimate_competition_factor(), should_play()
  - Wiederverwendung von calculate_birthday_score() Logik aus popularity_correlation.py
  - 43 Unit Tests, alle bestanden (AC-1 bis AC-5 abgedeckt)
  - Integration in analysis/__init__.py mit allen Exports
  - Backtest-Script scripts/backtest_popularity_risk.py erstellt
  - Axiom-First basiert auf A2 (Dauerscheine) und A3 (Attraktivitaet)
  - Competition-Factor Berechnung auf empirischen Daten (HYP-004 r=0.3921, 1.3x Winner-Ratio)
---

# Rule Confirmation
- Rule 1 (SYSTEM_STATUS + ADR/Docs + git status): CONFIRMED
- Rule 2 (granularity stated): global (zahlenbasiert fuer KENO 1-70)
- Rule 3 (semantics defined): PopularityRiskScore (0-1), birthday_score, pattern_score, competition_factor
- Rule 4 (target metric): bet-selection (ROI-Impact via Konkurrenz-Reduktion)
- Rule 5 (helper-only boundaries): CONFIRMED
- Rule 6 (reproducibility): `pytest tests/unit/test_popularity_risk.py -v` -> 43 passed in 0.88s

## Task Setup
- Granularity: global (zahlenbasiert fuer KENO 1-70)
- Semantics: PopularityRiskScore dataclass mit score, birthday_score, pattern_score, competition_factor, risk_level
- Target metric: bet-selection (ROI-Impact durch Konkurrenz-Reduktion)

## Repro Commands
- `pytest tests/unit/test_popularity_risk.py -v` -> 43 passed
- `python scripts/backtest_popularity_risk.py --config config/keno.yaml` -> results/popularity_risk_backtest.json

# Umsetzung

## 1. Neues Modul: kenobase/analysis/popularity_risk.py

**Kernfunktionen:**
- `calculate_birthday_score(numbers)`: Anteil Birthday-Zahlen (1-31), Return 0.0-1.0
- `calculate_pattern_score(numbers)`: Anteil Pattern-Zahlen, Return 0.0-1.0
- `estimate_competition_factor(birthday_score, pattern_score)`: Konkurrenz-Faktor (1.0-1.3)
- `calculate_popularity_risk_score(numbers)`: Kombinierter Score
- `should_play(numbers)`: Entscheidungsfunktion
- `adjust_recommendation_by_popularity(numbers, base_score)`: Score-Anpassung
- `analyze_draw_popularity(drawn_numbers)`: Ziehungs-Analyse

## 2. Unit Tests: 43 Tests in 7+ Klassen, alle bestanden

## 3. Backtest-Script: scripts/backtest_popularity_risk.py

## Validation
```
$ pytest tests/unit/test_popularity_risk.py -v
============================= 43 passed in 0.88s ==============================
```
