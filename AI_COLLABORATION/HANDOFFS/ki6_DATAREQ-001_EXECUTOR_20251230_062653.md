---
status: COMPLETE
task: DATAREQ-001
role: EXECUTOR
phase: EXECUTOR
files_changed:
  - scripts/validate_a6_regional.py
  - kenobase/scraper/lotto_hessen_api.py
  - kenobase/scraper/__init__.py
  - tests/unit/test_a6_validation.py
  - results/a6_validation.json
summary:
  - A6 validation script created (scripts/validate_a6_regional.py)
  - Implements P6.1 (population correlation), P6.2 (jackpot per capita), P6.3 (temporal uniformity)
  - Lotto Hessen API client added (kenobase/scraper/lotto_hessen_api.py)
  - Tests added and passing (7/7)
  - Existing scraper infrastructure already complete (16 Landeslotterien configured)
  - Current data: only 2 records (Brandenburg) - insufficient for full validation
  - Recommendation: Run full scrape with `python scripts/scrape_press.py --all`
---
# Rule Confirmation
- Rule 1 (SYSTEM_STATUS + ADR/Docs + git status): CONFIRMED
- Rule 2 (granularity stated): per-bundesland
- Rule 3 (semantics defined): RegionalWinEvent (bundesland, city, numbers, amount, date)
- Rule 4 (target metric): A6 Axiom Validation (P6.1/P6.2/P6.3)
- Rule 5 (helper-only boundaries): CONFIRMED
- Rule 6 (reproducibility): python scripts/validate_a6_regional.py --scraped-dir data/scraped -> results/a6_validation.json

## Task Setup
- Granularity: per-bundesland (16 Bundeslaender)
- Semantics: RegionalWinEvent (bundesland, city, numbers, keno_type, amount_eur, date)
- Target metric: A6 Axiom Validation

## Repro Commands
- `python scripts/validate_a6_regional.py --scraped-dir data/scraped -o results/a6_validation.json` -> results/a6_validation.json
- `python scripts/scrape_press.py --all --output data/scraped` -> data/scraped/keno_winners_*.json
- `python -m pytest tests/unit/test_a6_validation.py -v` -> 7/7 passed

# Umsetzung

## 1. Existing Infrastructure (Already Complete)

The scraper infrastructure was already fully implemented:

| Module | Status | Description |
|--------|--------|-------------|
| `kenobase/scraper/base.py` | COMPLETE | PressReleaseScraper class |
| `kenobase/scraper/landeslotterien.py` | COMPLETE | 16 Bundeslaender configs |
| `kenobase/scraper/parsers.py` | COMPLETE | KenoWinnerParser + Record |
| `kenobase/scraper/converters.py` | COMPLETE | JSON -> DrawResult conversion |
| `scripts/scrape_press.py` | COMPLETE | CLI for scraping |

## 2. New Files Created

### 2.1 A6 Validation Script

`scripts/validate_a6_regional.py`:
- Validates P6.1: Population correlation (Pearson r > 0.5)
- Validates P6.2: Jackpot per capita (Chi-square p > 0.05)
- Validates P6.3: Temporal uniformity (Kolmogorov-Smirnov p > 0.1)
- Uses existing scraped data from `data/scraped/`
- Outputs JSON to `results/a6_validation.json`

### 2.2 Lotto Hessen API Client

`kenobase/scraper/lotto_hessen_api.py`:
- JSON API client for automated data access
- Endpoint: `https://www.lotto-hessen.de/api/magazin/meldungen`
- Alternative to HTML scraping
- Exported in `__init__.py`

### 2.3 Unit Tests

`tests/unit/test_a6_validation.py`:
- 7 tests, all passing
- Tests count_wins_by_bundesland()
- Tests population data completeness (16 BL)
- Tests P6.1 validation logic
- Tests LottoHessenAPI configuration

## 3. Current Data Status

| Metric | Value |
|--------|-------|
| Total Records | 2 |
| Bundeslaender with Data | 1 (Brandenburg) |
| P6.1 Status | FAILED (r=-0.146, need >0.5) |
| P6.2 Status | N/A (insufficient data) |
| P6.3 Status | N/A (insufficient data) |

## 4. Next Steps

1. **Run full scrape:** `python scripts/scrape_press.py --all --output data/scraped`
2. **Re-run validation:** `python scripts/validate_a6_regional.py`
3. **Monitor for API access issues** (some sites may block)
4. **Consider Lotto Hessen API** as fallback: `from kenobase.scraper import fetch_hessen_winners`

## 5. Validation Commands

```powershell
# Scrape all 16 Bundeslaender
python scripts/scrape_press.py --all --output data/scraped

# Run A6 validation
python scripts/validate_a6_regional.py --scraped-dir data/scraped -o results/a6_validation.json

# Run tests
python -m pytest tests/unit/test_a6_validation.py -v
```

## 6. Files Changed Summary

```
scripts/validate_a6_regional.py          NEW - A6 validation script (318 lines)
kenobase/scraper/lotto_hessen_api.py     NEW - Hessen API client (143 lines)
kenobase/scraper/__init__.py             MODIFIED - Added LottoHessenAPI exports
tests/unit/test_a6_validation.py         NEW - Unit tests (130 lines)
results/a6_validation.json               NEW - Validation output
```
