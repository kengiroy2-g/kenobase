---
status: COMPLETE
task: TASK-R03
role: EXECUTOR
phase: EXECUTOR
files_changed:
  - config/default.yaml
  - kenobase/core/config.py
  - kenobase/core/regions.py
  - kenobase/core/data_loader.py
  - kenobase/analysis/regional_affinity.py
  - kenobase/analysis/__init__.py
  - kenobase/pipeline/runner.py
  - scripts/analyze.py
  - tests/unit/test_regional_affinity.py
  - docs/regional_affinity.md
  - results/regional_affinity.json
  - results/analyze_pipeline.json
  - AI_COLLABORATION/HANDOFFS/ki2_TASK-R03_EXECUTOR_20251228_062538.md
summary:
  - Added regional affinity analysis (lift + z-score per Bundesland) with smoothing/thresholds and exposed helpers for top lifts.
  - DataLoader now normalizes region metadata (Bundesland/Region/State) and config gained regional_affinity settings with defaults.
  - PipelineRunner integrates regional affinity step and exposes results in CLI output; analyze CLI can export JSON via --regional-affinity-output.
  - New docs at docs/regional_affinity.md cover method, config, and repro; unit tests added and executed for analysis behavior.
  - Artifact results/regional_affinity.json generated from data/raw/keno/KENO_ab_2018.csv (2237 draws) but contains warning: no region metadata present.
---
# Rule Confirmation
- Rule 1 (SYSTEM_STATUS + ADR/Docs + git status): UNVERIFIED (SYSTEM_STATUS.json missing; ADRs read; git status executed)
- Rule 2 (granularity stated): per-market
- Rule 3 (semantics defined): per-number regionale Affinitaet vs global baseline (lift + z-score/significance)
- Rule 4 (target metric): bet-selection
- Rule 5 (helper-only boundaries): CONFIRMED
- Rule 6 (reproducibility): python scripts/analyze.py analyze --config config/default.yaml --data data/raw/keno/KENO_ab_2018.csv --regional-affinity-output results/regional_affinity.json --output results/analyze_pipeline.json --format json -> results/regional_affinity.json

## Task Setup
- Granularity: per-market
- Semantics: regionale Zahl-Affinitaet (Lift/Signifikanz) je Bundesland relativ zur globalen Baseline inkl. Smoothing
- Target metric: bet-selection

## Repro Commands
- python scripts/analyze.py analyze --config config/default.yaml --data data/raw/keno/KENO_ab_2018.csv --regional-affinity-output results/regional_affinity.json --output results/analyze_pipeline.json --format json -> results/regional_affinity.json (warning: no region metadata found)
- pytest tests/unit/test_regional_affinity.py

# Umsetzung
- Implemented regional affinity module, loader normalization, config defaults, pipeline+CLI export, docs, tests, and generated artifact (regional data unavailable in source so analysis output contains warning).