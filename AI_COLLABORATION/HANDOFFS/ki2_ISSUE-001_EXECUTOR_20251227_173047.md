---
status: COMPLETE
task: ISSUE-001
role: EXECUTOR
phase: EXECUTOR
files_changed:
  - requirements.txt
  - config/default.yaml
  - scripts/master_update.py
summary:
  - Added selenium>=4.15.0 and beautifulsoup4>=4.12.0 to requirements.txt
  - Added scraper config section to default.yaml (chromedriver_path, headless, timeouts, URLs)
  - Implemented KenoScraper class with configurable settings from YAML
  - Replaced TODO stub in run_scrape() with full implementation
  - Scraper uses Selenium+BS4 pattern from reference (all_code/00_web_scrapping_V4_+_Datum.py)
  - Output saved to data/scraped/{game}_scraped_{year}.csv with auto-merge to main file
  - All syntax validated (Python + YAML)
  - CLI --help and --dry-run tested successfully
---

# Rule Confirmation
- Rule 1 (SYSTEM_STATUS + ADR/Docs + git status): CONFIRMED (SYSTEM_STATUS.json not found, git status checked)
- Rule 2 (granularity stated): per-game (KENO, EuroJackpot, Lotto)
- Rule 3 (semantics defined): Datum, Keno-Typ, Anzahl richtiger Zahlen, Anzahl der Gewinner, 1 Euro Gewinn
- Rule 4 (target metric): data-freshness (taegliche Updates via scraping)
- Rule 5 (helper-only boundaries): CONFIRMED
- Rule 6 (reproducibility): `python scripts/master_update.py --game keno --mode scrape --dry-run` -> logs/master_update.log

## Task Setup
- Granularity: per-game
- Semantics: Datum, Keno-Typ, gezogene Zahlen, Gewinnquoten
- Target metric: data-freshness

## Repro Commands
- `python scripts/master_update.py --help` -> Shows CLI usage
- `python scripts/master_update.py --game keno --mode scrape --dry-run` -> Dry run test
- `python scripts/master_update.py --game keno --mode scrape --year 2024` -> Actual scrape (requires Chrome + ChromeDriver)

# Implementation Details

## 1. requirements.txt Changes
Added under "# CLI" section:
- selenium>=4.15.0
- beautifulsoup4>=4.12.0

## 2. config/default.yaml Changes
Added new scraper section with:
- chromedriver_path: null (auto-detect)
- headless: true
- page_load_timeout: 30
- element_wait_timeout: 10
- max_retries: 3
- retry_delay: 5
- request_delay: 2
- urls: game-specific URLs

## 3. scripts/master_update.py Changes
- Added imports: yaml, time, Dict, Any
- Added load_config() function for YAML loading
- Added KenoScraper class (180 lines):
  - _get_driver(): Creates Chrome WebDriver with headless support
  - _select_year(): Year dropdown selection
  - _scrape_keno_for_date(): Single date/type scraping with retry logic
  - scrape_year(): Full year scraping with progress logging
- Updated run_scrape() method:
  - Checks for selenium/bs4 availability
  - Loads config from YAML
  - Uses KenoScraper for KENO game
  - Saves to data/scraped/ directory
  - Auto-merges with main data file

## Validation
- `python -m py_compile scripts/master_update.py` -> Syntax OK
- `python -c "import yaml; yaml.safe_load(...)"` -> YAML OK
- `python scripts/master_update.py --help` -> CLI works
- `python scripts/master_update.py --dry-run` -> Dry run works

## Notes for VALIDATOR
- Full scraping test requires Chrome browser and ChromeDriver installed
- EuroJackpot and Lotto scraping not yet implemented (returns False with warning)
- Acceptance criteria "update_data.py" mapped to existing master_update.py as noted in PROXY plan
